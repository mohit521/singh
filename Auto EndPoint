// AuthController.java
@RestController
@RequestMapping("/api/auth")
public class AuthController {
  private final UserService userService;
  private final JwtUtil jwtUtil;

  @PostMapping("/signup")
  public ResponseEntity<?> signup(@RequestBody SignupRequest req) {
    User u = userService.createUser(req.getEmail(), req.getPassword(), req.getFullName());
    String token = jwtUtil.generateToken(u.getEmail(), u.getRole());
    return ResponseEntity.ok(Map.of("token", token, "user", u.safeDto()));
  }

  @PostMapping("/login")
  public ResponseEntity<?> login(@RequestBody LoginRequest req) {
    User u = userService.authenticate(req.getEmail(), req.getPassword());
    String token = jwtUtil.generateToken(u.getEmail(), u.getRole());
    return ResponseEntity.ok(Map.of("token", token, "user", u.safeDto()));
  }
}
